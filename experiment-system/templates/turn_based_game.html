<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å­¦é¸æŠå”èª¿ã‚²ãƒ¼ãƒ  - ã‚¿ãƒ¼ãƒ³åˆ¶</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #e6ccff;
            padding: 15px;
            border: 2px solid #9966cc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .turn-indicator {
            font-size: 20px;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
        }
        .your-turn {
            background-color: #4CAF50;
        }
        .ai-turn {
            background-color: #ff9800;
        }
        .waiting-turn {
            background-color: #757575;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .game-info {
            background-color: #cce6ff;
            border: 2px solid #0066cc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .turn-section {
            background-color: white;
            border: 2px solid #666;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .proposal-section {
            background-color: white;
            border: 2px solid #2196F3;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;
        }
        .waiting-section {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            text-align: center;
            display: none;
        }
        .action-row {
            display: flex;
            align-items: center;
            margin: 15px 0;
            gap: 15px;
        }
        .action-row label {
            min-width: 120px;
            font-weight: bold;
        }
        select {
            padding: 8px;
            font-size: 14px;
            min-width: 180px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .action-button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .action-button:hover {
            background-color: #45a049;
        }
        .action-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .accept-button {
            background-color: #28a745;
        }
        .accept-button:hover {
            background-color: #218838;
        }
        .reject-button {
            background-color: #dc3545;
        }
        .reject-button:hover {
            background-color: #c82333;
        }
        .proposal-display {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .chat-section {
            background-color: #e8f5e8;
            border: 2px solid #4CAF50;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .chat-messages {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            background-color: white;
            border-radius: 3px;
        }
        .chat-message {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 3px;
        }
        .human-message {
            background-color: #e6f3ff;
            text-align: right;
        }
        .ai-message {
            background-color: #f0f0f0;
        }
        .chat-input {
            width: 80%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .send-button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .history-section {
            background-color: white;
            border: 2px solid #666;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .history-table th,
        .history-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        .history-table th {
            background-color: #f0f0f0;
            position: sticky;
            top: 0;
        }
        .human-action {
            background-color: #e6f3ff;
        }
        .ai-action {
            background-color: #fff2e6;
        }
        .proposal {
            background-color: #f0f0ff;
        }
        .accepted {
            background-color: #e8f5e8;
        }
        .rejected {
            background-color: #ffe6e6;
        }
        .current-status {
            margin-top: 20px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 5px;
        }
        .quit-section {
            text-align: center;
            margin-top: 20px;
        }
        .quit-button {
            background-color: #f44336;
            color: white;
            padding: 10px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <strong>ãƒ©ã‚¦ãƒ³ãƒ‰:</strong> <span id="currentRound">1</span> / 12
        </div>
        <div class="turn-indicator" id="turnIndicator">
            ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³
        </div>
        <div>
            <strong>æ®‹ã‚Šæ™‚é–“:</strong> <span id="timer">15:00</span>
        </div>
        <div>
            <strong>ã‚ãªãŸã®ã‚¹ã‚³ã‚¢:</strong> <span id="userScore">0</span>
        </div>
    </div>

    <div class="container">
        <div class="game-info">
            <p>ã“ã‚Œã¯<strong>ã‚¿ãƒ¼ãƒ³åˆ¶</strong>ã®å¤§å­¦é¸æŠå”èª¿ã‚²ãƒ¼ãƒ ã§ã™ã€‚</p>
            <ul>
                <li>å„ã‚¿ãƒ¼ãƒ³ã§1äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒææ¡ˆã‚’è¡Œã„ã¾ã™</li>
                <li>ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ææ¡ˆã‚’å—ã‘å…¥ã‚Œã‚‹ã‹æ‹’å¦ã™ã‚‹ã‹ã‚’æ±ºã‚ã¾ã™</li>
                <li>ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ã§ã¯ææ¡ˆã‚’ä½œæˆã—ã€ä»–ã®ã‚¿ãƒ¼ãƒ³ã§ã¯ææ¡ˆã«å¯¾ã—ã¦åˆ¤æ–­ã—ã¾ã™</li>
                <li>12ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ€è‰¯ã®å¤§å­¦é¸æŠåˆæ„ã‚’ç›®æŒ‡ã—ã¾ã™</li>
            </ul>
        </div>

        <!-- Your Turn Section -->
        <div class="turn-section" id="yourTurnSection">
            <h3>ğŸ¯ ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ - ææ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„</h3>
            
            <div class="action-row">
                <label>åŸºæº–:</label>
                <select id="criterionSelect">
                    <option value="">-- åŸºæº–ã‚’é¸æŠ --</option>
                    <option value="0">å­¦è¡“ãƒ¬ãƒ™ãƒ«</option>
                    <option value="1">è²»ç”¨</option>
                    <option value="2">ç«‹åœ°</option>
                    <option value="3">å°±è·å®Ÿç¸¾</option>
                </select>
            </div>
            
            <div class="action-row">
                <label>å¤§å­¦:</label>
                <select id="universitySelect">
                    <option value="">-- å¤§å­¦ã‚’é¸æŠ --</option>
                    <option value="0">Aå¤§å­¦</option>
                    <option value="1">Bå¤§å­¦</option>
                    <option value="2">Cå¤§å­¦</option>
                </select>
            </div>
            
            <div class="action-row">
                <label>ææ¡ˆå†…å®¹:</label>
                <select id="actionSelect">
                    <option value="">-- ææ¡ˆå†…å®¹ã‚’é¸æŠ --</option>
                    <option value="weight_increase">åŸºæº–é‡è¦åº¦ã‚’ä¸Šã’ã‚‹</option>
                    <option value="weight_decrease">åŸºæº–é‡è¦åº¦ã‚’ä¸‹ã’ã‚‹</option>
                    <option value="eval_increase">å¤§å­¦è©•ä¾¡ã‚’ä¸Šã’ã‚‹</option>
                    <option value="eval_decrease">å¤§å­¦è©•ä¾¡ã‚’ä¸‹ã’ã‚‹</option>
                </select>
            </div>
            
            <div class="action-row">
                <button class="action-button" onclick="makeProposal()" id="proposeButton" disabled>
                    ææ¡ˆã™ã‚‹
                </button>
            </div>
        </div>

        <!-- AI Turn / Proposal Response Section -->
        <div class="proposal-section" id="proposalSection">
            <h3>ğŸ’­ ææ¡ˆãŒå±Šãã¾ã—ãŸ</h3>
            <div id="proposalDisplay" class="proposal-display">
                <!-- Proposal details will be inserted here -->
            </div>
            <div class="action-row">
                <button class="action-button accept-button" onclick="respondToProposal(true)">
                    åŒæ„ã™ã‚‹
                </button>
                <button class="action-button reject-button" onclick="respondToProposal(false)">
                    æ‹’å¦ã™ã‚‹
                </button>
            </div>
        </div>

        <!-- Waiting Section -->
        <div class="waiting-section" id="waitingSection">
            <h3>â³ ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆ¤æ–­ã‚’å¾…ã£ã¦ã„ã¾ã™...</h3>
            <p>ç¾åœ¨ã®ææ¡ˆã«å¯¾ã™ã‚‹ä»–ã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å›ç­”ã‚’é›†è¨ˆä¸­ã§ã™ã€‚</p>
            <div id="responseStatus">
                <p>å›ç­”çŠ¶æ³: <span id="responseCount">0</span> / 3</p>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="chat-section">
            <h3>ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</h3>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message ai-message">
                    <strong>ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯AI:</strong> ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚å­¦è¡“ãƒ¬ãƒ™ãƒ«ã‚’é‡è¦–ã—ãŸè­°è«–ã‚’ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
                </div>
            </div>
            <div style="margin-top: 10px;">
                <input type="text" id="chatInput" class="chat-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." maxlength="200">
                <button class="send-button" onclick="sendMessage()">é€ä¿¡</button>
            </div>
        </div>

        <!-- Action History -->
        <div class="history-section">
            <h3>ğŸ“‹ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å±¥æ­´</h3>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>ãƒ©ã‚¦ãƒ³ãƒ‰</th>
                        <th>ææ¡ˆè€…</th>
                        <th>ææ¡ˆå†…å®¹</th>
                        <th>çµæœ</th>
                        <th>è©³ç´°</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                    <!-- History entries will be added here -->
                </tbody>
            </table>
        </div>

        <!-- Current Status -->
        <div class="current-status">
            <h4>ğŸ“Š ç¾åœ¨ã®çŠ¶æ³</h4>
            <div id="currentWeights">
                <strong>åŸºæº–é‡è¦åº¦:</strong> å­¦è¡“ãƒ¬ãƒ™ãƒ«(25%) | è²»ç”¨(25%) | ç«‹åœ°(25%) | å°±è·å®Ÿç¸¾(25%)
            </div>
            <div id="topUniversity" style="margin-top: 10px;">
                <strong>ç¾åœ¨ã®ç¬¬1å€™è£œ:</strong> Aå¤§å­¦ (ç·åˆã‚¹ã‚³ã‚¢: 0.75)
            </div>
        </div>

        <!-- Quit section -->
        <div class="quit-section">
            <button class="quit-button" onclick="quitGame()">
                ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã™ã‚‹
            </button>
        </div>
    </div>

    <script>
        // Game state
        let currentRound = 1;
        let maxRounds = 12;
        let currentTurn = 'human'; // 'human', 'ai1', 'ai2', 'ai3'
        let remainingTime = 15 * 60; // 15 minutes
        let gameTimer;
        let actionCounter = 1;
        let currentProposal = null;
        let waitingForResponses = false;

        const players = ['ã‚ãªãŸ', 'ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯AI', 'ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚«ãƒ«AI', 'ãƒãƒ©ãƒ³ã‚¹AI'];
        const aiAgents = ['ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯AI', 'ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚«ãƒ«AI', 'ãƒãƒ©ãƒ³ã‚¹AI'];

        // Initialize game
        function initializeGame() {
            startTimer();
            updateTurnDisplay();
            updateGameState();
            
            // Add event listeners
            document.getElementById('criterionSelect').addEventListener('change', validateProposal);
            document.getElementById('universitySelect').addEventListener('change', validateProposal);
            document.getElementById('actionSelect').addEventListener('change', validateProposal);
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
        }

        // Timer functions
        function startTimer() {
            gameTimer = setInterval(() => {
                remainingTime--;
                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;
                document.getElementById('timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (remainingTime <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // Turn management
        function updateTurnDisplay() {
            const indicator = document.getElementById('turnIndicator');
            const yourTurn = document.getElementById('yourTurnSection');
            const proposal = document.getElementById('proposalSection');
            const waiting = document.getElementById('waitingSection');

            // Hide all sections first
            yourTurn.style.display = 'none';
            proposal.style.display = 'none';
            waiting.style.display = 'none';

            if (waitingForResponses) {
                waiting.style.display = 'block';
                indicator.textContent = 'å›ç­”å¾…ã¡';
                indicator.className = 'turn-indicator waiting-turn';
            } else if (currentTurn === 'human') {
                yourTurn.style.display = 'block';
                indicator.textContent = 'ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³';
                indicator.className = 'turn-indicator your-turn';
            } else {
                proposal.style.display = 'block';
                indicator.textContent = `${currentTurn}ã®ã‚¿ãƒ¼ãƒ³`;
                indicator.className = 'turn-indicator ai-turn';
            }

            document.getElementById('currentRound').textContent = currentRound;
        }

        // Proposal validation
        function validateProposal() {
            const criterion = document.getElementById('criterionSelect').value;
            const university = document.getElementById('universitySelect').value;
            const action = document.getElementById('actionSelect').value;
            const button = document.getElementById('proposeButton');

            if (action.startsWith('weight_')) {
                button.disabled = !action;
            } else {
                button.disabled = !action || !criterion || !university;
            }
        }

        // Make proposal
        function makeProposal() {
            const criterion = document.getElementById('criterionSelect').value;
            const university = document.getElementById('universitySelect').value;
            const action = document.getElementById('actionSelect').value;

            if (!action) return;

            // Create proposal object
            const proposal = {
                proposer: 'ã‚ãªãŸ',
                criterion: criterion,
                university: university,
                action: action,
                round: currentRound
            };

            currentProposal = proposal;
            
            // Generate proposal text
            let proposalText = generateProposalText(proposal);
            
            // Add to history
            addToHistory(currentRound, 'ã‚ãªãŸ', proposalText, 'ææ¡ˆä¸­', 'proposal');
            
            // Clear form
            document.getElementById('criterionSelect').value = '';
            document.getElementById('universitySelect').value = '';
            document.getElementById('actionSelect').value = '';
            validateProposal();
            
            // Set waiting state
            waitingForResponses = true;
            updateTurnDisplay();
            
            // Simulate AI responses
            simulateAIResponses(proposal);
        }

        function generateProposalText(proposal) {
            const criteriaNames = ['å­¦è¡“ãƒ¬ãƒ™ãƒ«', 'è²»ç”¨', 'ç«‹åœ°', 'å°±è·å®Ÿç¸¾'];
            const universityNames = ['Aå¤§å­¦', 'Bå¤§å­¦', 'Cå¤§å­¦'];
            
            let text = '';
            if (proposal.action.startsWith('weight_')) {
                const actionType = proposal.action === 'weight_increase' ? 'é‡è¦åº¦ã‚’ä¸Šã’ã‚‹' : 'é‡è¦åº¦ã‚’ä¸‹ã’ã‚‹';
                text = `${criteriaNames[proposal.criterion]}ã®${actionType}`;
            } else {
                const actionType = proposal.action === 'eval_increase' ? 'è©•ä¾¡ã‚’ä¸Šã’ã‚‹' : 'è©•ä¾¡ã‚’ä¸‹ã’ã‚‹';
                text = `${universityNames[proposal.university]}ã®${criteriaNames[proposal.criterion]}${actionType}`;
            }
            return text;
        }

        // Simulate AI responses to human proposal
        function simulateAIResponses(proposal) {
            let responseCount = 0;
            const responses = [];
            
            // Update response status
            document.getElementById('responseCount').textContent = responseCount;
            
            aiAgents.forEach((agent, index) => {
                setTimeout(() => {
                    // Random response (could be more sophisticated)
                    const accepted = Math.random() > 0.4; // 60% acceptance rate
                    responses.push({ agent, accepted });
                    responseCount++;
                    
                    document.getElementById('responseCount').textContent = responseCount;
                    
                    if (responseCount === aiAgents.length) {
                        processProposalResults(proposal, responses);
                    }
                }, (index + 1) * 1500); // Staggered responses
            });
        }

        // Process AI proposal and show to human
        function showAIProposal() {
            // Generate random AI proposal
            const proposer = aiAgents[Math.floor(Math.random() * aiAgents.length)];
            const actions = ['weight_increase', 'weight_decrease', 'eval_increase', 'eval_decrease'];
            const action = actions[Math.floor(Math.random() * actions.length)];
            const criterion = Math.floor(Math.random() * 4);
            const university = Math.floor(Math.random() * 3);
            
            const proposal = {
                proposer: proposer,
                criterion: criterion.toString(),
                university: university.toString(),
                action: action,
                round: currentRound
            };
            
            currentProposal = proposal;
            const proposalText = generateProposalText(proposal);
            
            // Display proposal
            document.getElementById('proposalDisplay').innerHTML = `
                <strong>${proposer}ã‹ã‚‰ã®ææ¡ˆ:</strong><br>
                ${proposalText}<br>
                <small>ã“ã®ææ¡ˆã«åŒæ„ã—ã¾ã™ã‹ï¼Ÿ</small>
            `;
            
            // Add to history
            addToHistory(currentRound, proposer, proposalText, 'åˆ¤æ–­å¾…ã¡', 'proposal');
        }

        // Respond to proposal
        function respondToProposal(accepted) {
            if (!currentProposal) return;
            
            const result = accepted ? 'åŒæ„' : 'æ‹’å¦';
            
            // Update history
            updateHistoryResult(currentProposal, result);
            
            // Simulate other AI responses
            const otherResponses = [];
            aiAgents.forEach(agent => {
                if (agent !== currentProposal.proposer) {
                    otherResponses.push({
                        agent: agent,
                        accepted: Math.random() > 0.3 // 70% acceptance from AI
                    });
                }
            });
            
            // Process results
            processProposalResults(currentProposal, [{agent: 'ã‚ãªãŸ', accepted}, ...otherResponses]);
        }

        // Process proposal results
        function processProposalResults(proposal, responses) {
            const acceptCount = responses.filter(r => r.accepted).length;
            const totalResponses = responses.length;
            
            let resultText;
            let resultClass;
            
            if (acceptCount > totalResponses / 2) {
                resultText = `æ¡ç”¨ (${acceptCount}/${totalResponses})`;
                resultClass = 'accepted';
                updateGameState(); // Apply the change
            } else {
                resultText = `å´ä¸‹ (${acceptCount}/${totalResponses})`;
                resultClass = 'rejected';
            }
            
            // Update history
            updateHistoryResult(proposal, resultText, resultClass);
            
            // Add individual responses to chat
            responses.forEach(response => {
                addChatMessage(response.agent, `ææ¡ˆã«${response.accepted ? 'åŒæ„' : 'åå¯¾'}ã—ã¾ã—ãŸ`);
            });
            
            // Next turn
            setTimeout(() => {
                nextTurn();
            }, 2000);
        }

        // Next turn
        function nextTurn() {
            waitingForResponses = false;
            
            if (currentTurn === 'human') {
                currentTurn = 'ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯AI';
            } else {
                const currentIndex = aiAgents.indexOf(currentTurn);
                if (currentIndex === aiAgents.length - 1) {
                    // End of round
                    currentRound++;
                    currentTurn = 'human';
                    
                    if (currentRound > maxRounds) {
                        endGame();
                        return;
                    }
                } else {
                    currentTurn = aiAgents[currentIndex + 1];
                }
            }
            
            updateTurnDisplay();
            
            // If AI turn, show their proposal
            if (currentTurn !== 'human') {
                setTimeout(showAIProposal, 1000);
            }
        }

        // Chat functions
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage('ã‚ãªãŸ', message);
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const responses = [
                    'ãªã‚‹ã»ã©ã€èˆˆå‘³æ·±ã„è¦–ç‚¹ã§ã™ã­',
                    'ãã‚Œã«ã¤ã„ã¦ã‚‚ã†å°‘ã—è©³ã—ãæ•™ãˆã¦ãã ã•ã„',
                    'ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†',
                    'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸåˆ¤æ–­ãŒé‡è¦ã§ã™ã­',
                    'ã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã®åˆ©ç›Šã‚’è€ƒæ…®ã—ã¾ã—ã‚‡ã†'
                ];
                const aiAgent = aiAgents[Math.floor(Math.random() * aiAgents.length)];
                const response = responses[Math.floor(Math.random() * responses.length)];
                addChatMessage(aiAgent, response);
            }, 1000 + Math.random() * 2000);
        }

        function addChatMessage(sender, message) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender === 'ã‚ãªãŸ' ? 'human-message' : 'ai-message'}`;
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // History functions
        function addToHistory(round, proposer, content, result, className = '') {
            const tableBody = document.getElementById('historyTableBody');
            const row = document.createElement('tr');
            row.className = className;
            row.id = `history-${actionCounter}`;
            row.innerHTML = `
                <td>${round}</td>
                <td>${proposer}</td>
                <td>${content}</td>
                <td id="result-${actionCounter}">${result}</td>
                <td></td>
            `;
            tableBody.appendChild(row);
            actionCounter++;
            
            // Scroll to bottom
            const historySection = document.querySelector('.history-section');
            historySection.scrollTop = historySection.scrollHeight;
        }

        function updateHistoryResult(proposal, result, className = '') {
            const resultCell = document.getElementById(`result-${actionCounter - 1}`);
            const row = document.getElementById(`history-${actionCounter - 1}`);
            
            if (resultCell) {
                resultCell.textContent = result;
            }
            if (row && className) {
                row.classList.add(className);
            }
        }

        // Game state updates
        function updateGameState() {
            // Update scores (simplified)
            const newScore = Math.floor(Math.random() * 50) + 250;
            document.getElementById('userScore').textContent = newScore;
            
            // Update current weights display (simplified)
            const weights = ['25%', '25%', '25%', '25%']; // Could be dynamic
            document.getElementById('currentWeights').innerHTML = 
                `<strong>åŸºæº–é‡è¦åº¦:</strong> å­¦è¡“ãƒ¬ãƒ™ãƒ«(${weights[0]}) | è²»ç”¨(${weights[1]}) | ç«‹åœ°(${weights[2]}) | å°±è·å®Ÿç¸¾(${weights[3]})`;
        }

        // Game end
        function endGame() {
            clearInterval(gameTimer);
            alert('ã‚²ãƒ¼ãƒ çµ‚äº†ï¼çµæœãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚');
            window.location.href = '/results';
        }

        function quitGame() {
            if (confirm('æœ¬å½“ã«ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ')) {
                endGame();
            }
        }

        // Initialize when page loads
        window.onload = function() {
            initializeGame();
            
            // Load AHP data from previous page if available
            const criteriaData = localStorage.getItem('ahpCriteriaComparisons');
            const alternativeData = localStorage.getItem('ahpAlternativeComparisons');
            if (criteriaData && alternativeData) {
                console.log('AHP Criteria:', JSON.parse(criteriaData));
                console.log('AHP Alternatives:', JSON.parse(alternativeData));
            }
        };
    </script>
</body>
</html>