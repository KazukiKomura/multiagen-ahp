<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP基準比較</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .comparison-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #333;
            text-align: center;
            padding: 8px;
            font-size: 12px;
        }
        .comparison-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .criteria-cell {
            background-color: #e6f3ff;
            font-weight: bold;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            width: 30px;
        }
        .scale-header {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            background-color: #f0f0f0;
            font-size: 10px;
            padding: 5px 3px;
            line-height: 1.2;
        }
        .comparison-row.completed {
            background-color: #e8f5e8;
        }
        .checkbox-cell {
            width: 40px;
        }
        input[type="checkbox"] {
            transform: scale(1.2);
        }
        .progress {
            margin: 20px 0;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        .next-button {
            display: block;
            margin: 30px auto;
            padding: 15px 40px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        .criterion-section {
            margin-bottom: 30px;
        }
        .criterion-section h3 {
            background-color: #e6f3ff;
            padding: 10px;
            border-left: 5px solid #0066cc;
            margin-bottom: 15px;
        }
        .next-button:enabled {
            opacity: 1;
        }
        .next-button:hover:enabled {
            background-color: #45a049;
        }
        .instructions {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>大学選択基準の重要度比較</h1>
        
        <div class="instructions" id="criteria-instructions">
            <strong>ステップ1: 基準の重要度比較</strong><br>
            各行で、左の基準と右の基準を比較し、どちらがどの程度重要かを選択してください。
            全6組の比較を完了すると代替案比較に進みます。
        </div>
        
        <div class="instructions" id="alternative-instructions" style="display: none;">
            <strong>ステップ2: 基準ごとの大学比較</strong><br>
            各基準について、大学同士を比較してください。
            全12組の比較（4基準×3組ずつ）を完了するとゲームに進めます。
        </div>
        
        <div class="progress" id="progress">進捗: 0 / 6</div>
        <div id="alternative-progress" class="progress" style="display: none;">代替案比較進捗: 0 / 12</div>
        
        <table class="comparison-table" id="criteria-table">
            <thead>
                <tr>
                    <th rowspan="2">比較項目</th>
                    <th>左の項目が絶対的によい</th>
                    <th>左の項目が非常によい</th>
                    <th>左の項目がよい</th>
                    <th>左の項目がやや良い</th>
                    <th>左右同じくらいよい</th>
                    <th>右の項目がやや良い</th>
                    <th>右の項目がよい</th>
                    <th>右の項目が非常によい</th>
                    <th>右の項目が絶対的によい</th>
                    <th rowspan="2">比較項目</th>
                </tr>
                <tr class="scale-header">
                    <th>9</th>
                    <th>7</th>
                    <th>5</th>
                    <th>3</th>
                    <th>1</th>
                    <th>1/3</th>
                    <th>1/5</th>
                    <th>1/7</th>
                    <th>1/9</th>
                </tr>
            </thead>
            <tbody id="comparison-rows">
                <!-- Comparison rows will be generated by JavaScript -->
            </tbody>
        </table>
        
        <!-- Alternative comparison tables (hidden initially) -->
        <div id="alternative-tables" style="display: none;">
            <div id="criterion-0" class="criterion-section">
                <h3>学術レベル による大学比較</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th rowspan="2">比較項目</th>
                            <th>左が絶対的によい</th>
                            <th>左が非常によい</th>
                            <th>左がよい</th>
                            <th>左がやや良い</th>
                            <th>同じくらい</th>
                            <th>右がやや良い</th>
                            <th>右がよい</th>
                            <th>右が非常によい</th>
                            <th>右が絶対的によい</th>
                            <th rowspan="2">比較項目</th>
                        </tr>
                        <tr class="scale-header">
                            <th>9</th><th>7</th><th>5</th><th>3</th><th>1</th><th>1/3</th><th>1/5</th><th>1/7</th><th>1/9</th>
                        </tr>
                    </thead>
                    <tbody id="alt-rows-0"></tbody>
                </table>
            </div>
            
            <div id="criterion-1" class="criterion-section">
                <h3>費用 による大学比較</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th rowspan="2">比較項目</th>
                            <th>左が絶対的によい</th>
                            <th>左が非常によい</th>
                            <th>左がよい</th>
                            <th>左がやや良い</th>
                            <th>同じくらい</th>
                            <th>右がやや良い</th>
                            <th>右がよい</th>
                            <th>右が非常によい</th>
                            <th>右が絶対的によい</th>
                            <th rowspan="2">比較項目</th>
                        </tr>
                        <tr class="scale-header">
                            <th>9</th><th>7</th><th>5</th><th>3</th><th>1</th><th>1/3</th><th>1/5</th><th>1/7</th><th>1/9</th>
                        </tr>
                    </thead>
                    <tbody id="alt-rows-1"></tbody>
                </table>
            </div>
            
            <div id="criterion-2" class="criterion-section">
                <h3>立地 による大学比較</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th rowspan="2">比較項目</th>
                            <th>左が絶対的によい</th>
                            <th>左が非常によい</th>
                            <th>左がよい</th>
                            <th>左がやや良い</th>
                            <th>同じくらい</th>
                            <th>右がやや良い</th>
                            <th>右がよい</th>
                            <th>右が非常によい</th>
                            <th>右が絶対的によい</th>
                            <th rowspan="2">比較項目</th>
                        </tr>
                        <tr class="scale-header">
                            <th>9</th><th>7</th><th>5</th><th>3</th><th>1</th><th>1/3</th><th>1/5</th><th>1/7</th><th>1/9</th>
                        </tr>
                    </thead>
                    <tbody id="alt-rows-2"></tbody>
                </table>
            </div>
            
            <div id="criterion-3" class="criterion-section">
                <h3>就職実績 による大学比較</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th rowspan="2">比較項目</th>
                            <th>左が絶対的によい</th>
                            <th>左が非常によい</th>
                            <th>左がよい</th>
                            <th>左がやや良い</th>
                            <th>同じくらい</th>
                            <th>右がやや良い</th>
                            <th>右がよい</th>
                            <th>右が非常によい</th>
                            <th>右が絶対的によい</th>
                            <th rowspan="2">比較項目</th>
                        </tr>
                        <tr class="scale-header">
                            <th>9</th><th>7</th><th>5</th><th>3</th><th>1</th><th>1/3</th><th>1/5</th><th>1/7</th><th>1/9</th>
                        </tr>
                    </thead>
                    <tbody id="alt-rows-3"></tbody>
                </table>
            </div>
        </div>
        
        <button class="next-button" id="nextButton" disabled onclick="goToGame()">
            次へ：ゲーム開始
        </button>
    </div>

    <script>
        const criteria = ["学術レベル", "費用", "立地", "就職実績"];
        const universities = ["A大学", "B大学", "C大学"];
        const criteriaComparisons = [];
        const alternativeComparisons = [];
        let criteriaCompletedCount = 0;
        let alternativeCompletedCount = 0;
        let currentPhase = 'criteria';

        // Generate criteria comparison pairs
        for (let i = 0; i < criteria.length; i++) {
            for (let j = i + 1; j < criteria.length; j++) {
                criteriaComparisons.push([i, j, criteria[i], criteria[j]]);
            }
        }

        // Generate alternative comparison pairs for each criterion
        for (let c = 0; c < criteria.length; c++) {
            for (let i = 0; i < universities.length; i++) {
                for (let j = i + 1; j < universities.length; j++) {
                    alternativeComparisons.push([c, i, j, criteria[c], universities[i], universities[j]]);
                }
            }
        }

        function generateComparisonRows() {
            const tbody = document.getElementById('comparison-rows');
            
            criteriaComparisons.forEach((comp, index) => {
                const [i, j, criteriaA, criteriaB] = comp;
                const row = document.createElement('tr');
                row.className = 'comparison-row';
                row.id = `row-${i}-${j}`;
                
                let html = `
                    <td class="criteria-cell">${criteriaA}</td>
                `;
                
                // Scale values: 9, 7, 5, 3, 1, 1/3, 1/5, 1/7, 1/9
                const scaleValues = [9, 7, 5, 3, 1, 1/3, 1/5, 1/7, 1/9];
                scaleValues.forEach(value => {
                    html += `<td class="checkbox-cell">
                        <input type="checkbox" name="comparison-${i}-${j}" value="${value}" 
                               onchange="handleComparison(${i}, ${j}, this)">
                    </td>`;
                });
                
                html += `<td class="criteria-cell">${criteriaB}</td>`;
                row.innerHTML = html;
                tbody.appendChild(row);
            });
        }

        function handleComparison(i, j, checkbox, phase = 'criteria') {
            const name = phase === 'criteria' ? `comparison-${i}-${j}` : `alt-comparison-${i}-${j}`;
            const rowId = phase === 'criteria' ? `row-${i}-${j}` : `alt-row-${i}-${j}`;
            
            if (checkbox.checked) {
                // Uncheck other checkboxes in the same row
                const rowCheckboxes = document.querySelectorAll(`input[name="${name}"]`);
                rowCheckboxes.forEach(cb => {
                    if (cb !== checkbox) {
                        cb.checked = false;
                    }
                });
                
                // Mark row as completed
                const row = document.getElementById(rowId);
                row.classList.add('completed');
                
                updateProgress();
            } else {
                // If unchecked, remove completed status
                const row = document.getElementById(rowId);
                row.classList.remove('completed');
                updateProgress();
            }
        }

        function updateProgress() {
            if (currentPhase === 'criteria') {
                criteriaCompletedCount = 0;
                criteriaComparisons.forEach(([i, j]) => {
                    const rowCheckboxes = document.querySelectorAll(`input[name="comparison-${i}-${j}"]`);
                    const hasSelection = Array.from(rowCheckboxes).some(cb => cb.checked);
                    if (hasSelection) {
                        criteriaCompletedCount++;
                    }
                });
                
                document.getElementById('progress').textContent = `進捗: ${criteriaCompletedCount} / ${criteriaComparisons.length}`;
                
                // Check if criteria phase is complete
                if (criteriaCompletedCount === criteriaComparisons.length) {
                    setTimeout(showAlternativePhase, 500);
                }
            } else {
                alternativeCompletedCount = 0;
                alternativeComparisons.forEach(([c, i, j]) => {
                    const rowCheckboxes = document.querySelectorAll(`input[name="alt-comparison-${c}-${i}-${j}"]`);
                    const hasSelection = Array.from(rowCheckboxes).some(cb => cb.checked);
                    if (hasSelection) {
                        alternativeCompletedCount++;
                    }
                });
                
                document.getElementById('alternative-progress').textContent = `代替案比較進捗: ${alternativeCompletedCount} / ${alternativeComparisons.length}`;
                
                const nextButton = document.getElementById('nextButton');
                nextButton.disabled = alternativeCompletedCount < alternativeComparisons.length;
            }
        }

        function showAlternativePhase() {
            currentPhase = 'alternatives';
            
            // Hide criteria elements
            document.getElementById('criteria-instructions').style.display = 'none';
            document.getElementById('progress').style.display = 'none';
            document.getElementById('criteria-table').style.display = 'none';
            
            // Show alternative elements
            document.getElementById('alternative-instructions').style.display = 'block';
            document.getElementById('alternative-progress').style.display = 'block';
            document.getElementById('alternative-tables').style.display = 'block';
            
            updateProgress();
        }

        function generateAlternativeRows() {
            alternativeComparisons.forEach((comp) => {
                const [c, i, j, criterion, uniA, uniB] = comp;
                const tbody = document.getElementById(`alt-rows-${c}`);
                const row = document.createElement('tr');
                row.className = 'comparison-row';
                row.id = `alt-row-${c}-${i}-${j}`;
                
                let html = `<td class="criteria-cell">${uniA}</td>`;
                
                const scaleValues = [9, 7, 5, 3, 1, 1/3, 1/5, 1/7, 1/9];
                scaleValues.forEach(value => {
                    html += `<td class="checkbox-cell">
                        <input type="checkbox" name="alt-comparison-${c}-${i}-${j}" value="${value}" 
                               onchange="handleComparison(${c}, '${i}-${j}', this, 'alternatives')">
                    </td>`;
                });
                
                html += `<td class="criteria-cell">${uniB}</td>`;
                row.innerHTML = html;
                tbody.appendChild(row);
            });
        }

        function goToGame() {
            // Collect criteria comparison data
            const criteriaData = {};
            criteriaComparisons.forEach(([i, j]) => {
                const rowCheckboxes = document.querySelectorAll(`input[name="comparison-${i}-${j}"]`);
                const selectedCheckbox = Array.from(rowCheckboxes).find(cb => cb.checked);
                if (selectedCheckbox) {
                    criteriaData[`${i},${j}`] = parseFloat(selectedCheckbox.value);
                }
            });
            
            // Collect alternative comparison data
            const alternativeData = {};
            alternativeComparisons.forEach(([c, i, j]) => {
                const rowCheckboxes = document.querySelectorAll(`input[name="alt-comparison-${c}-${i}-${j}"]`);
                const selectedCheckbox = Array.from(rowCheckboxes).find(cb => cb.checked);
                if (selectedCheckbox) {
                    alternativeData[`${c}-${i}-${j}`] = parseFloat(selectedCheckbox.value);
                }
            });
            
            // Store data in localStorage for the next page
            localStorage.setItem('ahpCriteriaComparisons', JSON.stringify(criteriaData));
            localStorage.setItem('ahpAlternativeComparisons', JSON.stringify(alternativeData));
            
            // Navigate to P2P game page
            window.location.href = '/p2p_game';
        }

        // Initialize
        generateComparisonRows();
        generateAlternativeRows();
    </script>
</body>
</html>